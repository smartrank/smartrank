<html>
<head>
<title>SmartRank ${project.version}</title>
<style>
@media print {
    .no-print, .no-print * {
        display: none !important;
    }
    
    a {
        color: black;
        text-decoration: none;
    }

    .appendix {
        page-break-before: always;
    }

    .section {
        page-break-before: always;
    }
}

@page {
    margin: 10% 
}

.titlepage {
    margin-top: 30%;
    page-break-after: always;
    text-align: center;
    text-shadow: gray;
}

.appendix {
    border-top: medium;
    border-color: black;
}

body {
    counter-reset: sectioncounter;
    counter-reset: subsectioncounter;
    counter-reset: subsubsectioncounter;
    counter-reset: appendixcounter;
}

.onnewpage {
    page-break-before: always;    
}

.section {
    counter-increment: sectioncounter;
    counter-reset: imagecounter subsectioncounter subsubsectioncounter;
}

.sectiontitle:before {
    content: counter(sectioncounter) ".\0000a0\0000a0";
}

.subsection {
    counter-increment: subsectioncounter;
    counter-reset: subsubsectioncounter;
    page-break-inside: avoid
}

.subsectiontitle:before {
    content: counter(sectioncounter)"." counter(subsectioncounter) ".\0000a0\0000a0";
}

.subsubsection {
    counter-increment: subsubsectioncounter;
    page-break-inside: avoid
}

.subsubsectiontitle:before {
    content: counter(sectioncounter)"." counter(subsectioncounter) "." counter(subsubsectioncounter) ".\0000a0\0000a0";
}

.imagecaption {
     counter-increment: imagecounter;
     text-align: center;
     font-size: small;
}

.imagecaption:before {
    content: "Image " counter(sectioncounter) "." counter(imagecounter) ":\0000a0\0000a0";
}

.imageTable {
	margin-left: auto;
	margin-right: auto;
	border: 0px;
}

.sql {
    color: blue; 
    border: 1px solid black ;
}

table {
	border: 1px solid black;
}

table thead tr {
	background-color: black;
	color: white;
	font-weight: bold;
}

table tbody tr:nth-child(odd) {
    background-color: #dddddd;
}

.sqlKeyword {
    color: purple; 
    font-style: italic;
}

ol {
  list-style-type: none;
  counter-reset: item;
  margin: 0;
  padding: 0;
}

ol > li {
  display: table;
  counter-increment: item;
  margin-bottom: 0.6em;
}

ol > li:before {
  content: counters(item, ".") ". ";
  display: table-cell;
  padding-right: 0.6em;    
}

li ol > li {
  margin: 0;
}

li ol > li:before {
  content: counters(item, ".") " ";
}
</style>

</head>
<body>
    <div class="titlepage">
        <img alt="SmartRank Logo" src="images/qubodup-bloodSplash.png" align="middle">
        <h1>
            <a id="Top">SmartRank</a>
        </h1>
        <p>User manual</p>
        <p>Version ${project.version}</p>
    </div>
    
    <span class="no-print"><button onclick="doPrint()" title="Print the manual">Print the manual</button></span>
    <script type="text/javascript">
        function doPrint() {
            window.print();
        }
    </script>

    <p id="TableOfContents"></p>

    <div class="introduction section">
        <h2 class="sectiontitle"><a id="Introduction">Introduction</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>
        <p>Welcome to the manual for SmartRank version ${project.version}.</p>
        <p>
        SmartRank is a robust likelihood ratio software that enables searching of national DNA-databases with complex DNA-profiles. The methodology is 
        optimized to enable searches of (increasingly) voluminous DNA-databases, while keeping the rate of false negative and false positive errors at 
        a minimum. SmartRank enables a more efficient searching of DNA-databases with partial and/or complex profiles. 
        SmartRank should primarily be used as a tool to acquire intelligence data.</p>
        
        <h2>Note regarding results</h2>
        Starting with version 1.0.3, the optimization known as 'Shutting Down the Q Designation' has been disabled. 
        Consequently the numerical results of version 1.0.3 and above are no longer directly comparable to those from earlier versions of SmartRank.
        If results are to be compared between different versions of SmartRank, please see <span class="reference">PresettingRestrictionsParameters</span> 
        on how to re-enable the Q Designation Shutdown using the <code>qDesignationShutdown</code> option. The effects of the Q Designation Shutdown are described in 
        <a href="Benschop_2016_Proceedings ISHI2016_Searching national DNA databases with complex STR DNA profiles.pdf">ISHI 2016 proceedings</a> located in the 'manual' subfolder of the SmartRank installation folder. 
    </div>
    
    <h3>
        <a id="BasicSteps">Basic Steps</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
    </h3>
    <div>
        The basic steps for operating SmartRank are as follows:

        <ul>
            <li>
                <i>Optional:</i>
                exporting the eligible specimens from an existing
                database (e.g. CODIS or CCDNA)
            </li>
            <li>Load or connect to the database</li>
            <li>Load one or more crime scene samples</li>
            <li>
                <i>Optional:</i>
                load profiles for known individuals
            </li>
            <li>Formulate hypotheses</li>
            <li>Load population statistics</li>
            <li>Set search parameters</li>
            <li>Perform a search</li>
            <li>Examine the results</li>
            <li>Export a report</li>
        </ul>
        
        To help reduce mistakes in operation of the software, the user interface enforces that non-optional steps must be fulfilled before you can proceed to the next step.
    </div>

    <div class="section">
        <h2 class="sectiontitle">
            <a id="LoadingTheDatabase">Loading or connecting to the database</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h2>
        <p>
            The first step of using SmartRank is to load the database containing the candidate profiles. The database can be loaded on the 
            <i>DNA database</i> tab. Any format problems will be displayed in the table at the bottom of the panel. Details of which 
            specimen, locus and cause of the problem can be viewed here. Continuing with format problems still present will result in the problematic 
            locus or specimen - depending on the nature of the problem - being excluded from the analysis.
        </p>
        <table class="imageTable">
            <tr><td><img src="images/database1.png" alt="the database tab"></td></tr>
            <tr><td><div class="imagecaption">the database tab</div></td></tr>
           </table>
        <p> The DNA database can be read from a file or from a direct database connection.
    <div class="subsection">
        <h3 class="subsectiontitle"><a id="ReadingSpecimensCSV">Reading from a CSV file</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h3>
           The DNA database can be read from a CSV file. See <span class="reference">DatabaseFormat</span> for more information on 
           the expected contents of the CSV file. Click the Browse... button. to select a database file. 
        <p>
           CODIS users, please see <span class="reference">DatabaseExport</span> for the SQL query can be used to export the specimens to a suitable format.  
        <table class="imageTable">
            <tr><td><img src="images/database2.png"></td></tr>
            <tr><td><div class="imagecaption">a successfully loaded database with a single formatting error</div></td></tr>
        </table>
        </div>
    <div class="subsection">
        <h3 class="subsectiontitle"><a id="ReadingSpecimensJDBC">Reading specimens through a direct database connection</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h3>
           <p>
           SmartRank has the capability to connect directly Microsoft SQLServer, SAP Adaptive Server Enterprise or H2 databases. 
           On the Database tab, click the Connect... button to bring up the Database Settings screen on which you can review or configure the connection to the database.
        <table class="imageTable">
            <tr><td><img src="images/database-connect-dialog.png"></td></tr>
            <tr><td><div class="imagecaption">the Database Settings dialog</div></td></tr>
           </table>
           <br>
           On this screen the following settings can be made:
           <table>
               <thead>
                 <tr>
                 <th>Setting</th>
                 <th>Description</th>
	              </tr>
	            </thead>
	            <tbody>
               <tr><td>Database Type</td><td>The type of DBMS that is used for the DNA database. Supported types are SQLServer, Sybase and H2.</td></tr>
               <tr><td>Host:Port</td><td>The network address and port of the database server.</td></tr>
               <tr><td>Database Name</td><td>The schema name of the DNA database.</td></tr>
               <tr><td>Username</td><td>The username under which to log in.</td></tr>
               <tr><td>Password</td><td>The password for logging in to the database.</td></tr>
               <tr><td>Save Password</td><td>Indicates whether the password is to be stored in the configuration file. <br><b>IMPORTANT NOTE:</b> the storage of the password is in no way secure! Only use this option if the machine SmartRank runs on is in a trusted environment.</td></tr>
               <tr><td>Specimen Keys Query</td><td>The query to be executed in order to obtain a list of all eligible specimens in the database.</td></tr>
               <tr><td>Specimen Retrieval Batch Size</td><td>This value indicates how many specimens are to be retrieved from the database in one go. This can be set to 0 to retrieve all specimens, but this may have adverse effects on the responsiveness of SmartRank while specimens are being retrieved!</td></tr>
               <tr><td>Specimen Retrieval Query</td><td>The query to be executed in order to obtain the data for some or all of the specimens in the database.</td></tr>
               <tr><td>Database Revision Query</td><td>The query to be executed in order to obtain a value that uniquely identifies the current state of the database.</td></tr>
           </tbody>
           </table>
           <br><br>
           If the settings are not correct, an error is shown just below the Sample Query box. An example is shown below:
        <table class="imageTable">
            <tr><td><img src="images/database-connect-dialog-error.png"></td></tr>
            <tr><td><div class="imagecaption">example of an error message in the Database Settings dialog</div></td></tr>
           </table>
           <div class="onnewpage">
	        	When using direct database access to obtain specimen data, SmartRank uses the following flow:
	        	<OL>
	        	<LI>Before each search, the Database Revision Query is run to detect changes in the database since the last validation. If changes are detected, the database is re-validated before the search is executed. Note that this query is optional. If it is not configured, the database will not be re-validated and changes (particularly newly added records) will not be detected.</LI>
	        	<LI>The Specimen Keys Query is executed to obtain a list of unique keys (identifying values) for all specimens that qualify for a SmartRank search</LI>
	        	<LI>For each batch, as configured by the Specimen Retrieval Batch Size value, the Specimen Retrieval Query is run to get the actual specimen data.</LI>
	        	</OL> 
       	  </div>
       	  When using CODIS, please see <span class="reference">CodisQueries</span>.
       	  

    <div class="subsubsection">
        <h3 class="subsubsectiontitle"><a id="DatabaseRevisionQuery">The Database Revision Query</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h3>
        This query obtains a value that identifies the current state of the database, so that changes to can be detected at a future time. An example of this is the identifier (key) of the latest Audit Trail record in the CODIS datamodel.  
        Since not all databases and datamodels may have a way of getting this value, the query is optional.
        <h4>Expected properties of the query</h4>
        In order for the results of the query to be understood correctly be SmartRank, the results of the query must meet the following criteria:
        <UL>
        	<LI>The query must return a single column in its result</LI>
        	<LI>Only the first row of the result is used. If more rows are returned, they are ignored.</LI>
        	<LI>Any type of data can be returned (VARCHAR, INT etc).</LI>
        </UL>
	</div>     
	   
    <div class="subsubsection">
        <h3 class="subsubsectiontitle"><a id="SpecimenKeysQuery">The Specimen Keys Query</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h3>
        This query obtains a list of keys for all specimens in the database that qualify as candidates for a SmartRank search. The query is executed once before every search.
        
           <h4>Expected properties of the query</h4>
           In order for the results of the query to be understood correctly be SmartRank, the results of the query must meet the following criteria:
           <UL>
               <LI>The result of the query must be a single column.</LI>
               <LI>Results must be grouped by specimen.</LI>
           </UL>
	</div>

    <div class="subsubsection">
        <h3 class="subsubsectiontitle"><a id="SpecimenRetrievalQuery">The Specimen Retrieval Query</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h3>
        	This query returns the actual content of specimens.
        	
           <h4>Expected properties of the query</h4>
           In order for the results of the query to be understood correctly be SmartRank, the results of the query must meet the following criteria:
           <UL>
               <LI>
                   The result of the query must be at least 3 columns. The order of the columns is not important, but the names of these columns must be '<i>specimenId</i>', '<i>locus</i>' and '<i>allele</i>'.
                   If the result set holds more columns, statistics will be kept on the number of distinct values returned. The report and logfile will contain
                   a table listing the values and the number of occurrences for each value.
               </LI>
               <LI>The alleles for a locus can be returned in a single row - by separating the allele values with spaces in the <i>allele</i> column - or by returning a row for each allele value.</LI>
               <LI>The query can contain 2 '?' placeholders that will be replaced by the first and last ID of a batch of specimens to retrieve.</LI>
               <LI>Results must be grouped by specimen.</LI>
           </UL>
           <h4>Examples</h4>
           <div style="column-count:2; column-gap: 20px;">
               <div style="break-inside: avoid;">
                   The following result set is <b>valid</b>. Each allele is returned in its own row.
                   <table>    
                       <thead>
                         <tr>
	                         <th>SpecimenId</th>
	                         <th>locus</th>
	                         <th>allele</th>
	                      </tr>
	                    </thead>
                      <tbody>
	                      <tr><td>ID-1</td><td>vWA</td><td>11</td></tr>
	                      <tr><td>ID-1</td><td>vWA</td><td>12</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>13.2</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>14</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>8</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>12</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>17</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>18</td></tr>
                      </tbody>
                   </table>
                   The following result set is <b>valid</b>. Each allele is returned in its own row. An additional field is returned under the name 'Specimen Type'.
                   <table>    
                       <thead>
                         <tr>
	                         <th>SpecimenId</th>
	                         <th>locus</th>
	                         <th>allele</th>
	                         <th>Specimen Type</th>
	                      </tr>
	                    </thead>
                      <tbody>
	                      <tr><td>ID-1</td><td>vWA</td><td>11</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-1</td><td>vWA</td><td>12</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>13.2</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>14</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>8</td><td>Missing Person</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>12</td><td>Missing Person</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>17</td><td>Missing Person</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>18</td><td>Missing Person</td></tr>
	                      <tr><td>ID-3</td><td>vWA</td><td>8</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-3</td><td>vWA</td><td>12</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-3</td><td>FGA</td><td>17</td><td>Convicted Offender</td></tr>
	                      <tr><td>ID-3</td><td>FGA</td><td>18</td><td>Convicted Offender</td></tr>
                      </tbody>
                   </table>
                   The 'Specimen Type' field will in the result set will cause a table to be included in the report and logfile:
                   <table>
                   <thead>
                   	<tr>
                   	<th>
                   		Specimen Type
                   	</th>
                   	</tr>
                   </thead>
                   <tbody>
                   	<tr><td>Convicted Offender</td><td>2</td></tr>
                   	<tr><td>Missing Person</td><td>1</td></tr>
                   	</tbody>
                   </table>
                   <br>The following result set is <b>valid</b>. Alleles for a locus are returned in a single row, the values separated by spaces.
                   <table>    
                       <thead>
                         <tr>
	                         <th>SpecimenId</th>
	                         <th>locus</th>
	                         <th>allele</th>
	                      </tr>
	                    </thead>
	                    <tbody>
	                      <tr><td>ID-1</td><td>vWA</td><td>11 12</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>13.2 14</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>8 12</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>17 18</td></tr>
                      </tbody>
                   </table>
               </div>
               <div style="break-inside: avoid;"">
                   The following result set is <b>invalid</b>. The results are not grouped by specimenId.
                   <table>    
                       <thead>
                         <tr>
	                         <th>SpecimenId</th>
	                         <th>locus</th>
	                         <th>allele</th>
	                      </tr>
	                    </thead>
	                    <tbody>
	                      <tr><td>ID-1</td><td>vWA</td><td>11</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>8</td></tr>
	                      <tr><td>ID-1</td><td>vWA</td><td>12</td></tr>
	                      <tr><td>ID-2</td><td>vWA</td><td>12</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>13.2</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>17</td></tr>
	                      <tr><td>ID-1</td><td>FGA</td><td>14</td></tr>
	                      <tr><td>ID-2</td><td>FGA</td><td>18</td></tr>
                      </tbody>
                   </table>
                   <br>The following result set is <b>invalid</b>. The column names are not the ones recognized by SmartRank.
                   <table>    
                       <thead>
                         <tr>
                         <th>RecordName</th>
                         <th>Marker</th>
                         <th>PCR Value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr><td>ID-1</td><td>vWA</td><td>11 12</td></tr>
                      <tr><td>ID-1</td><td>FGA</td><td>13.2 14</td></tr>
                      <tr><td>ID-2</td><td>vWA</td><td>8 12</td></tr>
                      <tr><td>ID-2</td><td>FGA</td><td>17 18</td></tr>
                   </tbody>
                   </table>
               </div>
           </div>
        <br>
    </div>
    </div>
    </div>
    
    <div class="section">
        <h2 class="sectiontitle"><a id="LoadingCrimesceneProfiles">Loading crime scene profiles</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>
        <p>
 				Load the mix profile(s) for crime stains on the <i>Crime-scene profiles</i> tab by clicking the Add button and
				selecting the appropriate file. After loading the sample file, the bottom table will show all loci detected
				in the file, along with their according alleles. In the top table, the basic information of the sample is
				shown along with a possibility to enable or disable the profiles for the analysis. If the file contains
				replicates, all these will be shown as individual samples. It is also possible to load replicates from multiple files.
		</p>
        <table class="imageTable">
            <tr><td><img src="images/crimeSceneProfile.png" alt="A successfully loaded crime scene sample"></td></tr>
            <tr><td><div class="imagecaption">a successfully loaded crime scene sample.</div></td></tr>
        </table>
        <p>The mix profile file must be in tab- or comma separated format. See <span class="reference">ProfileFormat</span> for more information.
        </p>
        <p>
	        <ul>
    		    <li>Use the <b>Enable all</b> and <b>Disable all</b> buttons to collectively enable or disable all loaded profiles.</li>  
        		<li>The <b>Enable added profiles</b> check-box controls whether profiles loaded through the 'Add' button are enabled by default.</li>
        	</ul>  
        </p>
        <p>To allow integration with other tools, it is possible to import search settings (samples, profiles, hypotheses etc.) from a single file. The format of 
        this file is described in <span class="reference">SearchCriteriaFormat</span>. Click the 'Load Search Criteria' button to select a file from which to 
        load the search criteria. Note that all current settings are discarded and reset to their defaults before loading the file. </p>
        <p>The 'Clear Search Criteria' button resets all settings (except those relating to the database and population statistics) to their default values. 
        In situations where multiple independent searches are to be carried out sequentially, this guarantees a clean starting point for new searches and avoids having to 
        restart SmartRank and re-validate the database before each search. 
        </p>
    </div>
    
    <div class="section">
        <h2 class="sectiontitle"><a id="LoadingKnownProfiles">Loading known profiles</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>
        <p>
            Optionally, just like loading crime scene profiles, you can load any known contributors to the mixed profile in the known profiles tab.     
        </p>
        <table class="imageTable">
            <tr><td><img src="images/knownProfile.png" alt="Known profile"></td></tr>
            <tr><td><div class="imagecaption">a successfully loaded known sample.</div></td></tr>
        </table>
        <p>
            The known profile file must be in tab- or comma separated format. See <a href="#ProfileFormat">Profile
                Format</a> for more information.
        </p>
        <p>
	        <ul>
    		    <li>Use the <b>Enable all</b> and <b>Disable all</b> buttons to collectively enable or disable all loaded profiles.</li>  
        		<li>The <b>Enable added profiles</b> check-box controls whether profiles loaded through the 'Add' button are enabled by default.</li>
        	</ul>  
        </p>
    </div>
    
    <div class="section">
        <h2 class="sectiontitle"><a id="FormulatingHypotheses">Formulating hypotheses</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>
        <p>
            On the top half of the search tab, the hypotheses for the prosecution and defense can be formulated. Select the contributors for each hypotheses 
            (known from the previously loaded known profiles and/or unknown by choosing the number of unknown contributors) and set their dropout probabilities.
            The dropout probabilities can also be estimated by SmartRank by pressing the 'Estimate dropout probabilities' button after loading the population
            statistics. In this case, SmartRank will use the 95% percentile of a Monte-Carlo simulation as the drop-out estimate. 
        </p>
        <table class="imageTable">
            <tr><td><img src="images/hypotheses.png" alt="Hypotheses"></td></tr>
            <tr><td><div class="imagecaption">formulating hypotheses for prosecution and defense</div></td></tr>
        </table>
    
	    <div class="subsection">
        <h3 class="subsectiontitle"><a id="LoadingPopulationStatisticsAndSettingParameters">Loading population statistics and setting parameters</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h3>
        <p>
            In the Parameters section of the Search tab, various settings can be configured that can influence the results of the search. See below for the possible settings and their effects.
        </p>
        <table class="imageTable">
            <tr><td><img src="images/populationStatistics.png" alt="Population statistics"></td></tr>
            <tr><td><div class="imagecaption">the Parameters section</div></td></tr>
        </table>
    	
    	The following settings can be made in the Parameters panel:
    	<table>
			<thead>
				<tr>
					<th>Setting</th>
					<th>Description</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>Population Statistics</td><td>Click the ... button to select a poulation statistics file. The population statistics file must be in tab- or comma separated format. See <span class="reference">PopulationFormat</span> for more information.</td></tr>
    			<tr><td>LR Threshold</td><td>Specimens that result in an LR at or below this threshold will not be reported.</td></tr>
    			<tr><td>Report top</td><td>At most this number of specimens will be reported.</td></tr>
    			<tr><td>Theta correction</td><td>The value for the Theta correction. To see how this parameter influences the search, please refer to the <a href="smartrank_specs_v1.1.pdf">statistical specifications</a> located in the 'manual' subfolder of the SmartRank installation folder.</td></tr>
    			<tr><td>Rare Allele Frequency</td><td>This frequency will be assigned to alleles that are not present in the population statistics.</td></tr>
    			<tr><td>Dropin Probability</td><td>The probability that an unrelated allele dropped into the mixture. To see how this parameter influences the search, please refer to the <a href="smartrank_specs_v1.1.pdf">statistical specifications</a>.</td></tr>
    			<tr><td>Estimate Dropout Probabilities</td><td>Click this button to perform a dropout estimation. Please refer to the <a href="smartrank_specs_v1.1.pdf">statistical specifications</a> for more information. This feature can be disabled in the restrictions file (see <span class="reference">PresettingParameters</span>)</td></tr>
    		</tbody>
    	</table>
    </div>
    </div>
    
    <div class="section">
        <h2 class="sectiontitle"><a id="PerformingSearch">Performing a search</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>

        <p>When both hypotheses have been formulated and the parameters have been set, the search can be started by
            pressing the 'Search' button. The estimated time to complete the search will be shown and once it is
            completed, any results will be displayed in the results box at the bottom half of the screen. If necessary,
            the search can be aborted at any time by pressing the red cross next to the progress bar.</p>
        <table class="imageTable">
            <tr><td><img src="images/searching.png" alt="SmartRank searching"></td></tr>
            <tr><td><div class="imagecaption">SmartRank running a search</div></td></tr>
        </table>
    </div>
    
    <div class="section">
        <h2 class="sectiontitle"><a id="ExaminingResults">Examining the results</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>
        <p>
            After the search is completed, the results (if any) will be displayed in the results panel at the bottom half of the screen. Any results exceeding
            the preset LR threshold will be displayed here. The Show Report button opens the PDF containing the search results. Pressing the Control key while clicking this button 
            will open the folder containing the report file instead of the file itself. The Show Log button open the log file generated during the search. Here also, pressing the Control 
            key while clicking this button will open the folder containing the log file. 
        <table class="imageTable">
            <tr><td><img src="images/results1.png" alt="Results 1"></td></tr>
            <tr><td><div class="imagecaption">displaying of search results</div></td></tr>
        </table>
        <p>
            The details of a matching profile can be viewed by double clicking the profile in the results table. In this detailed view, allelic mismatches
            between the sample and the candidate are highlighted in red.
        </p>
        <table class="imageTable">
            <tr><td><img src="images/results2.png" alt="Results 2"></td></tr>
            <tr><td><div class="imagecaption">more details of a single result</div></td></tr>
        </table>
        
        In the Profile Details screen, the specimen and crime scene samples are shown side-by-side. Alleles that do not match are highlighted. The Export Profile 
    button can be clicked to export the current profile to a CSV file, suitable for reading in LRmixStudio.</div>
    
    <div class="section">
        <h2 class="sectiontitle"><a id="ViewingReports">SmartRank output</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span></h2>
        <p>
        	Whenever a search is performed, a logfile is created recording the parameters with which the search is conducted, the input files used and the results obtained. This logfile is 
        	a plain text file that can be opened in any text editor. By default, the logfile is placed in a subfolder named SmartRankResults that is created in the folder containing the crimescene samples. 
        	The default location and file name of the logfile can be configured in the restrictions file (see <span class="reference">PresettingParameters</span>).
        </p>
        <p>
            After a search is performed, a report in PDF format is created containing the parameters and results of the search. By default, the report is placed in a subfolder 
            named SmartRankResults that is created in the folder containing the crimescene samples.  The default location and file name of the report can be configured in the 
            restrictions file (see <span class="reference">PresettingParameters</span>).
        </p>
        <p>
            Next to the logfile and report, SmartRank will export the reported profiles in CSV format in the same location as the report. The CSV files are in a format that is suitable to be 
            read by LRmixStudio. If this is not desired, the feature can be disabled in the restrictions file (see <span class="reference">PresettingParameters</span>).
        </p>
        <table class="imageTable">
            <tr><td><img src="images/log.png" alt="Log" border="1"></td></tr>
            <tr><td><div class="imagecaption">excerpt of the search log</div></td></tr>
        </table>
        <br />
        <table class="imageTable">
            <tr><td><img src="images/report.png" alt="Report" border=1></td></tr>
            <tr><td><div class="imagecaption">excerpt of the search report</div></td></tr>
        </table>
    </div>
    
    <div class="section">
        <h2 class="sectiontitle">
            <a id="PresettingParameters">Presetting parameters</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h2>
        <p>SmartRank uses a number of files to store configuration data. To support concurrently running instances of SmartRank each using their own configuration, 
        the names of these files can be configured. The files are: 
        <UL>
        	<LI><b>SmartRankRestrictions.properties</b>, which can be used to preset or set constraints to certain parameters. By default this file is located in the installation folder of the application. 
            The name and location of this file can be configured by starting SmartRank with the following option: <div style="white-space: nowrap"><font face="Courier New">-DsmartrankRestrictions=<i><b>&lt;location and name of the restrictions file&gt;</b></i></font></div>.</LI>
            <LI><b>SmartRank.properties</b>, which is used for storing the last entered parameter values for some parameters (e.g. the name of the last loaded statistics file).
            By default this file is located in the application directory. To configure the name of this file, start SmartRank with 
            the following option: <div style="white-space: nowrap"><font face="Courier New">-DsmartrankProperties=<i><b>&lt;location and name of the properties file&gt;</b></i></font></div>.</LI>
            <LI><b>logback.xml</b>, which is used to configure the location and content of the logfiles generated by SmartRank.
            By default this file is located in the application directory. To configure the name of this file, start SmartRank with 
            the following option: <div style="white-space: nowrap"><font face="Courier New">-DloggingConfigurationFile=<i><b>&lt;location and name of the logging configuration file&gt;</b></i></font></div>.</LI>  
        </UL>
    <p />
    <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="PresettingGUIParameters">Available parameters in the SmartRank.properties file</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h3>
        The SmartRank.properties file contains settings that allow easier operation of the application, e.g. by remembering selections made in earlier runs of the program. 
        These settings will be updated automatically by SmartRank as it runs and generally do not need to be edited by hand. The contents of this file may change between versions
        of SmartRank and no assumption should be made on the presence or value of any property defined in the file. In the current version,
        the following table lists those properties that may be of use for tailoring the way SmartRank looks.
        Each of these options can also be specified on the commandline, in which case this setting will take precedence over any value configured in the file. 
        To specify a value on the commandline, include the following argument when starting SmartRank: 
        <div style="white-space: nowrap"><font face="Courier New">-D<i>&lt;property name&gt;</i>=<i>&lt;property value&gt;</i></font></div>.
        <table>
        	<thead>
            <tr>
                <th><b>Property</b></th>
                <th><b>Function</b></th>
                <th><b>Allowed values</b></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>windowTitle</td>
                <td>Sets a string that will be included after the application name and version in the title of the SmartRank window. 
                Can be useful to distinguish between concurrently running instances of SmartRank.</td>
                <td>Any string. This property is optional and can be omitted, in which case the window title will be <i>SmartRank ${project.version}</i>.</td>
            </tr>
        	</tbody>
        </table>
    </div>
    
    <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="PresettingRestrictionsParameters">Available parameters in the restrictions file</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h3>
        Below is a list of possible parameters in the restrictions file and what effect it will have on the
        usage of SmartRank. Each of these options can also be specified on the commandline, in which case this setting will take precedence over any value configured in the file. 
        To specify a value on the commandline, include the following argument when starting SmartRank: 
        <div style="white-space: nowrap"><font face="Courier New">-D<i>&lt;property name&gt;</i>=<i>&lt;property value&gt;</i></font></div>.
        <table>
        	<thead>
            <tr>
                <th><b>Property</b></th>
                <th><b>Function</b></th>
                <th><b>Allowed values</b></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>automaticParameterEstimationEnabled</td>
                <td>Makes SmartRank automatically estimate dropout probabilities using
                    a Monte Carlo simulation. Manual input of dropout probabilities will be disabled.</td>
                <td>true/false</td>
            </tr>
            <tr>
                <td>batchMode</td>
                <td>When set to true, SmartRank will start in batch mode (see <span class="reference">BatchMode</span>).</td>
                <td>true/false</td>
            </tr>
            <tr>
                <td>caseLogFilename</td>
                <td>Sets the name of the logfile that is generated for each search.</td>
                <td>A template describing the name of case log files. See <span class="reference">TemplateStrings</span> for more information.</td>
            </tr>
            <tr>
                <td>dropoutMinimum</td>
                <td>Sets a minimum value for drop-out probability.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>dropoutDefault</td>
                <td>Sets a default value for drop-out probability.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>dropoutMaximum</td>
                <td>Sets a maximum value for drop-out probability.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>dropinMinimum</td>
                <td>Sets a minimum value for drop-in probability.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>dropinDefault</td>
                <td>Sets a default value for drop-in probability.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>dropinMaximum</td>
                <td>Sets a maximum value for drop-in probability.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>thetaMinimum</td>
                <td>Sets a minimum value for theta.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>thetaDefault</td>
                <td>Sets a default value for theta.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>thetaMaximum</td>
                <td>Sets a maximum value for theta.</td>
                <td>0.0 to 0.99</td>
            </tr>
            <tr>
                <td>maximumStoredResults</td>
                <td>Sets a maximum number of returned likelihood ratios.</td>
                <td>Any positive number, 250 by default</td>
            </tr>
            <tr>
                <td>maximumPathLength</td>
                <td>Sets the maximum length of paths for logfiles and reports. This to prevent creating files that cannot be read on some versions of Windows.</td>
                <td>Any positive number, 128 by default</td>
            </tr>
            <tr>
                <td>maximumUnknownCount</td>
                <td>Sets a maximum number of unknown contributors.</td>
                <td>Any positive number, 4 by default</td>
            </tr>
            <tr>
                <td>minimumNumberOfLoci</td>
                <td>Sets a minimum number of loci for a profile to be included in an analysis.</td>
                <td>Any positive number, 1 by default</td>
            </tr>            
            <tr>
                <td>interactiveParameterEstimationEnabled</td>
                <td>Makes dropout probability estimation manually executable.</td>
                <td>true/false</td>
            </tr>
            <tr>
                <td>parameterEstimationIterations</td>
                <td>The number of iterations used for estimating the dropout probability.</td>
                <td>Any positive number, 10000 by default</td>
            </tr>
            <tr>
                <td>reportFileName</td>
                <td>Sets the path, where analysis reports are exported to.</td>
                <td>A template describing the name of analysis report files. See <span class="reference">TemplateStrings</span> for more information.</td>
            </tr>
            <tr>
                <td>reportTemplateFileName</td>
                <td>Sets the path to the template, used for creating analysis reports.</td>
                <td>A filepath</td>
            </tr>
            <tr>
                <td>outputRootFolder</td>
                <td>When importing search criteria from a file, the output path specified in the file - if any - will be resolved relative to this folder. Especially useful when the machine generating the XML has different drive mappings than the machine running SmartRank.</td>
                <td>A filepath</td>
            </tr>
            <tr>
                <td>exportMatchingProfilesAfterSearch</td>
                <td>Indicates whether the profiles with LRs exceeding the LR Threshold should be exported to csv files after a search.</td>
                <td>true/false</td>
            </tr>
            <tr>
                <td>defaultLRThreshold</td>
                <td>The default value for the LR threshold.</td>
                <td>Any positive integer, 1000 by default</td>
            </tr>
            <tr>
            	<td>qDesignationShutdown</td>
            	<td>Indicates whether the Q Designation should be shut down for the calculation of <i><code>Pr(E|Hp)</code></i>. Please note that changing this value is <b>not recommended</b>, as it changes the numerical results of the program, and can cause performance problems. The setting is only present for testing purposes.</td>
            	<td>true/false, true by default</td>
            </tr>
            <tr>
                <td>windowCloseBlockedInBatchMode</td>
                <td>Indicates whether closing the application window is allowed when SmartRank Batch Mode is in running state. If set to true, closing application window while SmartRank is in running state (i.e. the run button has been clicked) will minimize the window instead.</td>
                <td>true/false, false by default</td>
            </tr>
            <tr>
                <td>batchMode.autoStart</td>
                <td>When in batch mode, this option can be specified to automatically connect to the database or load a database file and start the batch process when SmartRank is started.</td>
                <td><code>db</code> automatically connect to the database and start batch processing.<br>
                <code>file</code> automatically load the last-loaded file and start batch processing.</td>
            </tr>
            <tr>
                <td>batchMode.retentiondays</td>
                <td>When in batch mode, this option can be specified to automatically remove jobs that are older than the specified number of days.</td>
                <td>a positive integer. Specifying 0 will clean up processed jobs immediately. Default value is 14.</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="subsection">
        <h3 class="subsectiontitle"><a id="TemplateStrings">Template Strings</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span></h3>
        <p>
            Some values in the restrictions file are specified in Template Strings. These are strings containing placeholder markers that are replaced with actual 
            values to form the final string. Placeholders are enclosed in '{' and '}' characters (e.g. {DATE}, {TIME})
            This is useful for situations where the requested value is not fixed, but depends on the input at runtime.
        </p>
        <p>Example: the template string <b>The current time is <i>{TIME}</i></b> will be resolved to <b>The time is <i>133000</i></b> if the current system time is half past one in the afternoon.</p>
        <p>The following placeholders are defined:
            <ul>
                <li>DATE - resolves to the start date of the current search. The date is formatted using 4 digits for the year, 2 for the month and 2 for the day (e.g. 2016-02-02 for februari 2nd 2016)</li>
                <li>TIME - resolves to the start time of the current search. The time is formatted using 24-hour clock notation (e.g. 133244 for 32 minutes and 44 seconds past 1 in the afternoon.)</li>
                <li>CASE_FILES - resolves to the directory where the crime-scene sample file(s) are located</li>
                <li>CRIMESCENE_PROFILES - resolves to a comma-seperated list containing the ids of the crimescene profiles</li>
                <li>HP - resolves to a very brief description of Hp</li>
                <li>HD - resolves to a very brief description of Hd</li>
            </ul>
        </p>
    </div>
	</div>

	<div class="section">
		<h2 class="sectionTitle">
			<a id="BatchMode">Batch Mode</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span></h2>
        <p>Batch mode was introduced to reduce the number of manual actions when processing a large number of search queries.
        To activate Batch Mode, set the batchMode property to 'true' in the restrictions file (see <span class="reference">PresettingParameters</span>). </p>
        
        <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="BatchModeActivation">The Batch Mode Tab</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
        <p>When started in batch mode - and after loading a database - the Batch Mode tab is enabled. On this tab a directory can be selected that will be 
        monitored for Search Criteria files. The detected files will be shown in a list, and some basic management of search jobs is available.</p>
        <table class="imageTable">
            <tr><td><img src="images/batchmode1.png" alt="Batch Mode 1"></td></tr>
            <tr><td><div class="imagecaption">the Batch Mode tab</div></td></tr>
        </table>
         </div>
         
        <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="BatchModeInputFolder">Configuring the input folder</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
        <p>Batch Mode constantly monitors a configured input folder for search criteria files. The path of this directory can be typed into the Input Folder box, or the Browse 
        button can be used to select a directory using a file chooser dialog.  
        <table class="imageTable">
            <tr><td><img src="images/batchmode2.png" alt="Batch Mode 2"></td></tr>
            <tr><td><div class="imagecaption">selecting a directory to scan for search criteria files</div></td></tr>
        </table>
        Note that the selected folder will be periodically scanned for new files. These will be added to the list of detected files automatically.
        <p>
        </div>
        <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="BatchModeStatistics">Configuring default population statistics</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
        Search criteria files can either contain embedded population statistics or rely on an external file to supply the statistics. For files that do not contain population 
        statistics, a default statistics file can be configured. Enter the path of the file in the Population Statistics textbox, or use the Browse button to select the file
        with a file chooser dialog. If a default statistics file is not selected, files that do not contain embedded statistics cannot be not be processed, and will be moved 
        to the Failed state with an appropriate error message.
        <table class="imageTable">
            <tr><td><img src="images/batchmode5.png" alt="Batch Mode 5"></td></tr>
            <tr><td><div class="imagecaption">selecting a default population statistics file</div></td></tr>
        </table>
        </div>
        
        <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="BatchModeFileList">The file list</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
        <p>The batch mode tab will list the filename, status and any remarks for all search criteria files found in the input directory. This directory is periodically scanned 
        for new files, which will be added to the displayed list automatically. Select a line in the table to see more details in the lower section:
        <table class="imageTable">
            <tr><td><img src="images/batchmode3.png" alt="Batch Mode 3"></td></tr>
            <tr><td><div class="imagecaption">showing details of a selected file. In this case a file where the sample data for a contributor is listed under Hd could not be found. </div></td></tr>
        </table>
        As files are processed, they are assigned a status by SmartRank. The following status values are used:
    	<table>
			<thead>
				<tr>
					<th>Status</th>
					<th>Description</th>
					<th>File Location</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>Pending</td><td>Indicates that SmartRank has detected the presence of the file, and has verified that the file contains search criteria.</td><td>These files are present in the selected directory</td></tr>
    			<tr><td>Processing</td><td>Indicates that a file is currently being processed.</td><td>Before being processed, files are moved into the 'processing' subdirectory. If this subdirectory does not exist, it is created.</td></tr>
    			<tr><td>Failed</td><td>Indicates that an error was encountered when reading or processing the file. Depending on the nature of the failure, the files may be rescheduled by selecting the file and clicking the Restart button.</td><td>These files are moved to the 'failed' subdirectory. If this subdirectory does not exist, it is created.</td></tr>
    			<tr><td>Succeeded</td><td>Indicates that a search was performed using the criteria from the file, and that a report and logfile were created. Note that this does <b>not</b> necessarily mean that any matches were obtained.</td><td>These files are moved to the 'succeeded' subdirectory. If this subdirectory does not exist, it is created.</td></tr>
    			<tr><td>Interrupted</td><td>Indicates that the user interrupted the search before all specimens in the database were evaluated. Interrupted files can be re-scheduled by selecting them and clicking the Restart button.</td><td>These files are moved from the 'processing' subdirectory back to the of the input directory.</td></tr>
    			<tr><td>Cancelled</td><td>Indicates that the this file should be skipped. These files can be re-scheduled by selecting them and clicking the Restart button.</td><td>These files are moved to the 'Failed' directory.</td></tr>
    		</tbody>
    	</table>
         </div>
         <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="TheToolbar">The toolbar</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
         <p>Above the list of files a toolbar is displayed with which a number of actions can be performed. 
        <table class="imageTable">
            <tr><td><img src="images/batchmode4.png" alt="Batch Mode 4"></td></tr>
            <tr><td><div class="imagecaption">the toolbar</div></td></tr>
        </table>
         The toolbar contains the following buttons:
         <table>
			<thead>
				<tr>
					<th>Button</th>
					<th>Description</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>Stop</td><td>Stops processing files. If a file is currently being processed, SmartRank waits until this has completed. This button is disabled until the Run button is clicked.</td></tr>
    			<tr><td>Run</td><td>Starts performing searches for the files in the input directory. Files are processed in the order in which they appear in the list. The Up/Down/Top/Bottom buttons can be used to prioritized searches. Note that if the windowCloseBlockedInBatchMode option is set in the Restrictions file, the SmartRank window cannot be closed while Batch Mode is in running state.</td></tr>
    			<tr><td>Start Time</td><td>This field contains a time in 24-hour notation. SmartRank will wait until this time to start processing search criteria files after the Run button is clicked. Use the up and down arrows to increase or decrease the time, or type a value in the edit box. The default value for this field is 00:00.</td></tr>
    			<tr><td>End Time</td><td>This field contains a time in 24-hour notation. SmartRank stop processing search criteria files after this time. <br>
    			If a file is being processed when the End Time is reached, this search is completed but no subsequent file will be picked up until the Start Time is once again reached.<br>
    			 Use the up and down arrows to increase or decrease the time, or type a value in the edit box. The default value for this field is 23:59.</td></tr>
    			<tr><td>Top</td><td>Moves the selected file to the top of the list.</td></tr>
    			<tr><td>Up</td><td>Moves the selected file up one position.</td></tr>
    			<tr><td>Down</td><td>Moves the selected file down one position.</td></tr>
    			<tr><td>Bottom</td><td>Moves the selected file to the bottom of the list.</td></tr>
    			<tr><td>Clear completed</td><td>Removes Failed, Cancelled and Successful files from the list.</td></tr>
    			<tr><td>Restart</td><td>Sets the status of the selected file to Pending. This button is only enabled if a file with status Failed, Cancelled or Interrupted is selected.</td></tr>
    			<tr><td>Cancel</td><td>Sets the status of the currently selected file to Cancelled.</td></tr>
    			<tr><td>Edit PPScript</td><td>Opens a script editor and allows editing and testing of the post-processing script.</td></tr>
    		</tbody>
    	</table>
    	</div>
         If processing of a file is to be interrupted, use the interrupt button at the bottom right of the screen. 
         Once processing of a file has completed, the detail view for that file will show the locations of the logfile and report. Use the Show Log and Show Report buttons 
         to view the contents of these files, and use the Open Folder buttons to open the directory in which the files were written.
         <p>When all files have been processed, SmartRank will continue to monitor the selected directory, and automatically process any new search criteria files, 
         until the Stop button is clicked or SmartRank is closed.
         
                <div class="subsection">
        <h3 class="subsectiontitle">
            <a id="ThePostProcessingScript">The post-processing script</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
        <p>SmartRank can perform post-processing steps after every search job. These steps are configured in JavaScript. Please note that the post-processing script is run after both successful and failed jobs. 
        It is up to the script to determine whether specific actions need to be taken for either of these cases.  
        Clicking the Edit PPScript button in the toolbar opens up the post-processing script editor.
        <table class="imageTable">
            <tr><td><img src="images/scripteditor1.png"></td></tr>
            <tr><td><div class="imagecaption">the post-processing script editor</div></td></tr>
        </table>

		The post-processing editor consists of a number of different areas. The main area is the script editor, where the javascript code is shown that will be executed after each search. 
		To the right of this, an informational area shows some details of the objects that the script can call to obtain attributes of the search job. Below these areas is the console, which shows 
		the output of any <code>console.log</code> statements.<br>
		In the toolbar, the following options are available:
         <table>
			<thead>
				<tr>
					<th>Button</th>
					<th>Description</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>Save</td><td>Saves the contents of the script to a new file.</td></tr>
    			<tr><td>Load</td><td>Loads a script from a file.</td></tr>
    			<tr><td>Test</td><td>Executes the script in test mode. Test settings are loaded from the SearchCriteriaForTest.xml file located in the scriptingtestfiles 
    			folder of the application directory. In test mode, the file copyToDir method supplied by the FileUtils object will not actually copy a file, but rather log a descriptive 
    			text to the console window.</td></tr>
    		</tbody>
    	</table>
  		A number of objects are available in the script to obtain the status and other attributes of the current job, and also to perform some very basic file operations. 
  		The following sections contain a brief and by no means complete list of available objects and their available functions.
  	
  	<div class="subsubsection">
        <h3 class="subsubsectiontitle">
            <a id="TheJobHelper">The job helper object</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
  		The <code>job</code> helper object represents the current search job. It has functions to access the job's attributes such as whether the job finished successfully,
  		the name of the search criteria file, the search result etc. Some of the available functions are listed here:
         <table>
			<thead>
				<tr>
					<th>Function</th>
					<th>Parameters</th>
					<th>Description</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>getFileName</td><td></td><td>Returns a string containing the absolute filename of the search criteria file.</td></tr>
    			<tr><td>isSucceeded</td><td></td><td>returns true if the job was run successfully, false otherwise.</td></tr>
    			<tr><td>getErrorMessage</td><td></td><td>If the job failed, this function returns a description of the error.</td></tr>
    			<tr><td>getSearchResults</td><td></td><td>Returns an object descriubing the search results. See the information panel in the code editor for this object's porperties and functions.</td></tr>
    		</tbody>
    	</table>
  		
  	</div>

  	<div class="subsubsection">
        <h3 class="subsubsectiontitle">
            <a id="TheLogHelper">The log helper object</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
  		The <code>log</code> helper object allows a script to write log lines into the application log.
         <table>
			<thead>
				<tr>
					<th>Function</th>
					<th>Parameters</th>
					<th>Description</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>info</td><td>String msg</td><td>Writes the supplied string to the application log at info level.</td></tr>
    			<tr><td>warn</td><td>String msg</td><td>Writes the supplied string to the application log at warning level.</td></tr>
    			<tr><td>error</td><td>String msg</td><td>Writes the supplied string to the application log at error level.</td></tr>
    		</tbody>
    	</table>  	
   	</div>

  	<div class="subsubsection">
        <h3 class="subsubsectiontitle">
            <a id="TheFileUtilsHelper">The FileUtils helper object</a> <span class="no-print"><font size="1"><a href="#Top">Back to top</a></font></span>
        </h3>
  		The <code>FileUtils</code> helper object allows a script to perform limited file manipulation operations.
         <table>
			<thead>
				<tr>
					<th>Function</th>
					<th>Parameters</th>
					<th>Description</th>
				</tr>
			</thead>
    		<tbody>
    			<tr><td>fileName</td><td>String path</td><td>Parses the supplied absolute path and returns only the file's name and extension.</td></tr>
    			<tr><td>copyToDir</td><td>String fileName, String outputDir</td><td>Copies a file to a directory. On Windows, both the standard <i>drive:\path</i> format and UNC format (e.g. <i>\\host\path</i>) can be used.<br>If a file of the same name already exists in the output directory, the new file's name is changed to make it unique.</td></tr>
    		</tbody>
    	</table>  	
  	</div>
    </div>
  	</div>

    <div class="section">
        <h2 class="sectiontitle">
            <a id="TroubleShooting">Troubleshooting</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h2>
    <ul>
        <li><b>SmartRank won't start</b>
            <p>
                Check your Java version by opening a command prompt and typing:<br>
                <code>java -version</code>
                <br> SmartRank requires Java 1.7.0 or higher.<br>
                </p></li>
        <li><b>The report notes that a number of loci were not processed</b><p>
        	The following text may be present in the Comments section of the Results table in the SmartRank report.<br>  
        	<code>
        		Specimen loci not evaluated: TH01 and VWA<br>
				Crime Sample loci not evaluated: TH01 and VWA</code>
			The names of the loci in question will vary according to your specific situation.
			SmartRank only calculates an LR for the loci that are present in <b>all</b> of the following locations:
			<UL>
				<li>The crimescene sample</li>
				<li>All selected known donor profiles</li>
				<li>The current specimen</li>
				<li>The population statistics</li>
			</UL>
        	If a locus is missing in any of these places, an LR will <b>not</b> be calculated for that locus, and a remarks will be added to the Comments section for the specimen in question.
        </li>
        <li><b>SmartRank says it has run out of memory</b>
            <p>
                    When you see a dialog that looks something like this:<br> <img
                        alt="Screenshot of the Out-of-Memory dialog" src="images/out-of-memory-dialog.png"><br>it means
                    that SmartRank does not have enough memory to continue.
            </p>
                <p>This is primarily associated with older versions of Java. SmartRank needs more memory than these
                    older version allocate by default. To avoid this problem, try switching to a newer version of Java.</p>
            <p>
                Alternatively, you can start SmartRank with the following command line:<br>
                <code>java -jar smartrank-${project.version}.jar -Xmx2048m -Xms2048m</code>
                <br> This will start SmartRank with 2GB of memory.<br>
                </p></li>
    </ul>
    </div>

    <div class="appendix">
        <h2>
            Appendix A. <a id="DatabaseExport">DNA Database Export</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h2>

        <p>Using the query below, a SmartRank-compatible database file can be exported from a CODIS SQLServer database.</p>
        <pre style="color: blue; border: 1px solid black ;">
<span class="sqlKeyword">SELECT</span> 
    specimenId, CSF1PO_1, CSF1PO_2, CSF1PO_3, CSF1PO_4,
    D10S1248_1, D10S1248_2, D10S1248_3, D10S1248_4, D12S391_1,
    D12S391_2, D12S391_3, D12S391_4, D13S317_1, D13S317_2,
    D13S317_3, D13S317_4, D16S539_1, D16S539_2, D16S539_3,
    D16S539_4, D18S51_1, D18S51_2, D18S51_3, D18S51_4, 
    D19S433_1, D19S433_2, D19S433_3, D19S433_4, D1S1656_1,
    D1S1656_2, D1S1656_3, D1S1656_4, D21S11_1, D21S11_2,
    D21S11_3, D21S11_4, D22S1045_1, D22S1045_2, D22S1045_3,
    D22S1045_4, D2S1338_1, D2S1338_2, D2S1338_3, D2S1338_4,
    D2S441_1, D2S441_2, D2S441_3, D2S441_4, D3S1358_1,
    D3S1358_2, D3S1358_3, D3S1358_4, D5S818_1, D5S818_2,
    D5S818_3, D5S818_4, D7S820_1, D7S820_2, D7S820_3,
    D7S820_4, D8S1179_1, D8S1179_2, D8S1179_3, D8S1179_4,
    F13A1_1, F13A1_2, F13A1_3, F13A1_4, FES_FPS_1,
    FES_FPS_2, FES_FPS_3, FES_FPS_4, FGA_1, FGA_2,
    FGA_3, FGA_4, [Penta D_1], [Penta D_2], [Penta D_3],
    [Penta D_4], [Penta E_1], [Penta E_2], [Penta E_3], 
    [Penta E_4], SE33_1, SE33_2, SE33_3, SE33_4, TH01_1,
    TH01_2, TH01_3, TH01_4, TPOX_1, TPOX_2,
    TPOX_3,TPOX_4, vWA_1, vWA_2, vWA_3, vWA_4
<span class="sqlKeyword">FROM</span> 
(
    <span class="sqlKeyword">SELECT</span> 
        S.Spec_ID <span class="sqlKeyword">AS</span> [specimenId],
        <span class="sqlKeyword">CAST</span>(rtrim(Locus) <span
                class="sqlKeyword">AS</span> VARCHAR(50)) + '_' + <span
                class="sqlKeyword">CAST</span>(PV.Band_Num <span
                class="sqlKeyword">AS</span> VARCHAR(2)) [locus],
        rtrim(PV.PCR_Value) <span class="sqlKeyword">AS</span> [data]
    <span class="sqlKeyword">FROM</span> 
        CODIS.dbo.Specimen S
        <span class="sqlKeyword">INNER JOIN</span> CODIS.dbo.Sizing Z <span
                class="sqlKeyword">ON</span> S.Spec_CD = Z.Spec_CD 
        <span class="sqlKeyword">INNER JOIN</span> CODIS.dbo.PCR_Value PV <span
                class="sqlKeyword">ON</span> Z.Locus_CD = PV.Locus_CD 
        <span class="sqlKeyword">AND</span> Z.Spec_CD = PV.Spec_CD 
        <span class="sqlKeyword">INNER JOIN</span> CODIS.dbo.Locus L <span
                class="sqlKeyword">ON</span> Z.Locus_CD = L.Locus_CD
        <span class="sqlKeyword">WHERE</span> S.Spec_Type_CD <span
                class="sqlKeyword">IN</span> 
        (
            <span class="sqlKeyword">SELECT</span> 
                Spec_Type_CD 
            <span class="sqlKeyword">FROM</span> 
                CODIS.dbo.Spec_Type 
                <span class="sqlKeyword">WHERE</span> Spec_Type <span
                class="sqlKeyword">IN</span> 
                (
                    'Convicted Offender',
                    'Suspect, Known', 
                    'Elimination, Known'
                )
        )
) 
<span class="sqlKeyword">x PIVOT</span>
(
    <span class="sqlKeyword">MAX</span>(<span class="sqlKeyword">DATA</span>)
    <span class="sqlKeyword">FOR</span> locus <span
                class="sqlKeyword">IN</span>
    (
        CSF1PO_1, D10S1248_1, D12S391_1, D13S317_1, D16S539_1,
        D18S51_1, D19S433_1, D1S1656_1, D21S11_1, D22S1045_1, 
        D2S1338_1, D2S441_1, D3S1358_1, D5S818_1, D7S820_1, 
        D8S1179_1, F13A1_1, FES_FPS_1, FGA_1, [Penta D_1],
        [Penta E_1], SE33_1, TH01_1, TPOX_1, vWA_1, CSF1PO_2,
        D10S1248_2, D12S391_2, D13S317_2, D16S539_2, D18S51_2, 
        D19S433_2, D1S1656_2, D21S11_2, D22S1045_2, D2S1338_2,
        D2S441_2, D3S1358_2, D5S818_2, D7S820_2, D8S1179_2, 
        F13A1_2, FES_FPS_2, FGA_2, [Penta D_2], [Penta E_2], 
        SE33_2, TH01_2, TPOX_2, vWA_2, CSF1PO_3, D10S1248_3,
        D12S391_3, D13S317_3, D16S539_3, D18S51_3, D19S433_3, 
        D1S1656_3, D21S11_3, D22S1045_3, D2S1338_3, D2S441_3,
        D3S1358_3, D5S818_3, D7S820_3, D8S1179_3, F13A1_3,
        FES_FPS_3, FGA_3, [Penta D_3], [Penta E_3], SE33_3,
        TH01_3, TPOX_3, vWA_3, CSF1PO_4, D10S1248_4, D12S391_4,
        D13S317_4, D16S539_4, D18S51_4, D19S433_4, D1S1656_4,
        D21S11_4, D22S1045_4, D2S1338_4, D2S441_4, 
        D3S1358_4, D5S818_4, D7S820_4, D8S1179_4, F13A1_4, 
        FES_FPS_4, FGA_4, [Penta D_4], [Penta E_4], SE33_4, 
        TH01_4, TPOX_4, vWA_4
    )
) <span class="sqlKeyword">
AS</span> p
    </pre>
    </div>

    <div class="appendix">
        <h2>
            Appendix B. <a id="DatabaseFormat">DNA Database Format</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h2>
        <p>Currently, the only accepted format for a DNA database is a CODIS CSV format. A CODIS CSV file is a
            comma-separated file listing allelic information for one or multiple specimens. The first line contains a
            header; starting with specimen ID, followed by identifiers for genetic markers (e.g. THO1 or D3S1358).
            Specimens are listed below this header with a unique identifier and alleles for the above mentioned genetic
            markers.</p>
        <p>Below is an example of a DNA database file, containing allelic information of 10 different specimens.</p>
        <img src="images/databaseFormat.png" alt="Database format">
    </div>

    <div class="appendix">
        <h2 style="page-break-before: true">
            Appendix C. <a id="ProfileFormat">Profile format</a> <span class="no-print"><font size="1"><a
                    href="#Top">Back to top</a></font></span>
        </h2>
        <p>The accepted formats for profile files (crime scene- or known) are tab- or comma-separated files. The
            first line of the file contains a preset header of the profiles; it lists a sample name, a marker and up to
            eight alleles. Every detected marker in the sample is listed per row, describing what sample it originates
            from, its identifier and the allelic information associated with that marker.</p>
        <p>Below is an example of a crime scene sample file, containing allelic information of 15 identified
            markers. Known profile files use the same format.</p>
        <img src="images/profileFormat.png" alt="Profile format">
    </div>

    <div class="appendix">
        <h2>
            Appendix D. <a id="PopulationFormat">Population Statistics Format</a> <span class="no-print"><font
                size="1"><a href="#Top">Back to top</a></font></span>
        </h2>
        <p>The accepted format for population statistics files is tab- or comma-separated. Alleles are displayed
            vertically, loci horizontally. The cells where alleles and loci cross displays the probability of existence
            of that allele in that specific locus in the population. Should the allele never appear in a locus, the cell
            remains blank.</p>
        <p>Below is an example of a population statistics file, showing allelic probabilities of 16 different
            loci.</p>
        <img src="images/populationFormat.png" alt="Population format">
    </div>
    
    <div class="appendix">
        <h2>
            Appendix E. <a id="SearchCriteriaFormat">Search Criteria File Format</a> <span class="no-print"><font
                size="1"><a href="#Top">Back to top</a></font></span>
        </h2>
        <p>Search criteria can be imported from an XML file. An example of this file is shown below. See the xsd folder of the SmartRank installation folder for an XSD file describing the Search Criteria file format.</p>
        <pre>
        <font color=blue>&lt;SmartRankImportFile <font color=purple>version=<font color=red><font color=red>"1.0"</font></font></font> <font color=purple>xmlns=<font color=red>"urn:SmartRankImportFile-schema"</font></font>&gt;</font>
            <font color=green>&lt;!-- The case folder is the place where logfiles and reports are written to. 
                    This overrides the location configured in the restrictions file --&gt;</font>
            <font color=blue>&lt;CaseFolder&gt;</font><b>2016/01 januari/2016.01.01.001</b><font color=blue>&lt;/CaseFolder&gt;</font>
            
            <font color=green>&lt;!-- The user id of the person who generated this file --&gt;</font>
            <font color=blue>&lt;userid&gt;</font><b>MASLA</b><font color=blue>&lt;/userid&gt;</font>
            
            <font color=green>&lt;!-- The date and time that the file was generated (not used in smartrank, but present for tracability reasons) --&gt;</font>
            <font color=blue>&lt;dateTime&gt;</font><b>2016-08-22 15:24:23</b><font color=blue>&lt;/dateTime&gt;</font>
            
            <font color=green>&lt;!-- This contains references to all replicates (crime-scene profiles) --&gt;</font>
            <font color=blue>&lt;Replicates&gt;</font>
                <font color=green>&lt;!-- Each replicate get a Replicate item here. The name refers to the name of a Specimen (see below) --&gt;</font>
                <font color=blue>&lt;Replicate <font color=purple>name=<font color=red>"CEDU0059FR#07-KOEL0126LU#21"</font></font>/&gt;</font>
            <font color=blue>&lt;/Replicates&gt;</font>
            
            <font color=green>&lt;!-- The value to use for dropin --&gt;</font>
            <font color=blue>&lt;Dropin&gt;</font><b>0.10</b><font color=blue>&lt;/Dropin&gt;</font>
            
            <font color=green>&lt;!-- The value to use for theta --&gt;</font>
            <font color=blue>&lt;Theta&gt;</font><b>0.03</b><font color=blue>&lt;/Theta&gt;</font>
            
            <font color=green>&lt;!-- Specification of Hp. The candidateDropout attribute defines the dropout for the candidate sample. --&gt;</font>
            <font color=blue>&lt;HP <font color=purple>candidateDropout=<font color=red>"0.10"</font></font>&gt;</font>
                <font color=green>&lt;!-- Contains references to the samples that contributors under Hp, and their corresponding dropout --&gt;</font>
                <font color=blue>&lt;Contributors&gt;</font>
                    <font color=green>&lt;!-- Each sample that is a contributor under Hp gets a Contributor item here. 
                            The name refers to the name of a Specimen (see below) --&gt;</font>
                    <font color=blue>&lt;Contributor <font color=purple>name=<font color=red>"CEDU0059FR#07"</font></font> <font color=purple>dropout=<font color=red>"0.11"</font></font>/&gt;</font>
                <font color=blue>&lt;/Contributors&gt;</font>
                
                <font color=green>&lt;!-- Contains the settings for unknown contributors under Hp --&gt;</font>
                <font color=blue>&lt;Unknowns <font color=purple>count=<font color=red>"1"</font></font> <font color=purple>dropout=<font color=red>"0.12"</font></font>/&gt;</font>
            <font color=blue>&lt;/HP&gt;</font>

            <font color=green>&lt;!-- Specification of Hd. --&gt;</font>
            <font color=blue>&lt;HD&gt;</font>
                <font color=green>&lt;!-- Contains references to the samples that contributors under Hd, and their corresponding dropout --&gt;</font>
                <font color=blue>&lt;Contributors&gt;</font>
                    <font color=green>&lt;!-- Each sample that is a contributor under Hd gets a Contributor item here. 
                            The name refers to the name of a Specimen (see below) --&gt;</font>
                    <font color=blue>&lt;Contributor <font color=purple>name=<font color=red>"CEDU0059FR#07"</font></font> <font color=purple>dropout=<font color=red>"0.13"</font></font>/&gt;</font>
                <font color=blue>&lt;/Contributors&gt;</font>
                
                <font color=green>&lt;!-- Contains the settings for unknown contributors under Hd --&gt;</font>
                <font color=blue>&lt;Unknowns <font color=purple>count=<font color=red>"2"</font></font> <font color=purple>dropout=<font color=red>"0.14"</font></font>/&gt;</font>
            <font color=blue>&lt;/HD&gt;</font>
            
            <font color=green>&lt;!-- For every loaded crime-scene profile and known profile, a Specimen entry 
                    is included listing the contents of the sample. --&gt;</font>
            <font color=blue>&lt;Specimen <font color=purple>name=<font color=red>"CEDU0059FR#07-KOEL0126LU#21"</font></font>&gt;</font>
                <font color=green>&lt;!-- Every locus in the sample gets a Locus item here --&gt;</font>
                <font color=blue>&lt;Locus <font color=purple>name=<font color=red>"D16S539"</font></font>&gt;</font>
                    <font color=green>&lt;!-- Every allele in this locus gets an Allele item here --&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"11"</font></font>/&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"12"</font></font>/&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"13"</font></font>/&gt;</font>
                <font color=blue>&lt;/Locus&gt;</font>
                <font color=blue>&lt;Locus <font color=purple>name=<font color=red>"D18S51"</font></font>&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"14"</font></font>/&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"15"</font></font>/&gt;</font>
                <font color=blue>&lt;/Locus&gt;</font>
            <font color=blue>&lt;/Specimen&gt;</font>
            
            <font color=blue>&lt;Specimen <font color=purple>name=<font color=red>"CEDU0059FR#07"</font></font>&gt;</font>
                <font color=blue>&lt;Locus <font color=purple>name=<font color=red>"D16S539"</font></font>&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"11"</font></font>/&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"11"</font></font>/&gt;</font>
                <font color=blue>&lt;/Locus&gt;</font>
                <font color=blue>&lt;Locus <font color=purple>name=<font color=red>"D18S51"</font></font>&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"14"</font></font>/&gt;</font>
                    <font color=blue>&lt;Allele <font color=purple>value=<font color=red>"15"</font></font>/&gt;</font>
                <font color=blue>&lt;/Locus&gt;</font>
            <font color=blue>&lt;/Specimen&gt;</font>                
        <font color=blue>&lt;/SmartRankImportFile&gt;</font>
        </pre>
    </div>
    
    <div class="appendix">
        <h2>
            Appendix F. <a id="CodisQueries">Suggested queries for CODIS users</a> <span class="no-print"><font
                size="1"><a href="#Top">Back to top</a></font></span>
        </h2>
    	<p>The following queries can be used when accessing a CODIS database directly:
    	<UL>
    		<LI>Specimen Keys Query
    		<pre>
select S.Spec_CD
FROM CODIS.dbo.Specimen S
WHERE S.Spec_Type_CD IN (
    Select Spec_Type_CD 
    from CODIS.dbo.Spec_Type 
    where Spec_Type IN ('Convicted Offender','Suspect, Known', 'Elimination, Known'))
order by Spec_CD
			</pre>
    		</LI>
    		<LI>Specimen Retrieval Query
    		<pre>
SELECT S.Spec_ID as [specimenId], L.Locus, rtrim(PV.PCR_Value) as [allele]
FROM CODIS.dbo.Specimen S, CODIS.dbo.Locus L, CODIS.dbo.Sizing Z, CODIS.dbo.PCR_Value PV
WHERE S.Spec_CD = Z.Spec_CD
AND Z.Spec_CD = PV.Spec_CD 
AND Z.Locus_CD = L.Locus_CD
AND Z.Locus_CD = PV.Locus_CD  
AND S.Spec_CD between ? and ?
AND S.Spec_Type_CD IN (
    Select Spec_Type_CD 
    from CODIS.dbo.Spec_Type 
    where Spec_Type IN ('Convicted Offender','Suspect, Known', 'Elimination, Known'))
group by s.spec_id, L.locus, PV.PCR_Value
			</pre>
    		</LI>
    		<LI>Database Revision Query
    		<pre>
select max(Audit_CD)
FROM CODIS.dbo.Audit_Trail
			</pre>
    		</LI>
    	</UL>
    
    <!--  This code composes the table of contents at the top of the document -->
    <script type="text/javascript">
    	function resolveReferences(references, id, title, targetType) {
            for(ref=0;ref<references.length;ref++) {
                var reference = references[ref];
                if(reference.textContent === id) {
                    reference.innerHTML = "the <a href='#" + id + "'>&#39;" + title.trim() + "&#39;</a> " + targetType;
                } 
            }
    	}
    
        var i;
        var subcount;
        var t = "<h2><a id='TableOfContents'>Table of Contents</a></h2><OL class='toclist'>";
        var sections = document.getElementsByClassName("section")
        for(i=0;i<sections.length;i++) {
            var header = sections[i].getElementsByClassName("sectiontitle")[0];
            var anchor = header.getElementsByTagName("a")[0];
            var sectionTitle = header.innerHTML.replace(/<.*>/i, "") + anchor.textContent
			resolveReferences(document.getElementsByClassName("reference"), anchor.id, sectionTitle, "section");

            t += "<LI><a href='#" + anchor.id + "'>" +  sectionTitle + "</a>"

	        var subsections = sections[i].getElementsByClassName("subsection");
	        if(subsections.length > 0) {
	        	t += "<OL style=\"start:"+i+".1\">";
	        }
	        for(subcount=0;subcount<subsections.length;subcount++) {
	            var subheader = subsections[subcount].getElementsByClassName("subsectiontitle")[0];
	            var subanchor = subheader.getElementsByTagName("a")[0];
	            var subsectionTitle = subheader.innerHTML.replace(/<.*>/i, "") + subanchor.textContent
				resolveReferences(document.getElementsByClassName("reference"), subanchor.id, subsectionTitle, "subsection");
				t += "<LI><a href='#" + subanchor.id + "'>" +  subsectionTitle + "</a></LI>"
				
	        	var subsubsections = subsections[subcount].getElementsByClassName("subsubsection");
		        if(subsubsections.length > 0) {
		        	t += "<OL style=\"start:"+i+"."+subcount+".1\">";
		        }
	        	for(subsubcount=0;subsubcount<subsubsections.length;subsubcount++) {
		            var subsubheader = subsubsections[subsubcount].getElementsByClassName("subsubsectiontitle")[0];
		            var subsubanchor = subsubheader.getElementsByTagName("a")[0];
		            var subsubsectionTitle = subsubheader.innerHTML.replace(/<.*>/i, "") + subsubanchor.textContent
					resolveReferences(document.getElementsByClassName("reference"), subsubanchor.id, subsubsectionTitle, "subsubsection");
					t += "<LI><a href='#" + subsubanchor.id + "'>" +  subsubsectionTitle + "</a></LI>"
	        	}
		        if(subsubsections.length > 0) {
		        	t += "</OL>";
		        }
	        }
	        if(subsections.length > 0) {
	        	t += "</OL>";
	        }

            t += "</LI>"
        }
        t += "</OL>";

        t+= "<br><h2>Appendices</h2><ul class='toclist'>";
        var appendices = document.getElementsByClassName("appendix")
        for(app=0;app<appendices.length;app++) {
            var header = appendices[app].getElementsByTagName("h2")[0];
            var anchor = header.getElementsByTagName("a")[0];
            var appendixtitle = header.innerHTML.replace(/<.*>/i, "") + anchor.textContent;
			resolveReferences(document.getElementsByClassName("reference"), anchor.id, appendixtitle, "appendix");        		
            t += "<LI><a href='#" + anchor.id + "'>" + header.innerHTML.replace(/<.*>/i, "") + anchor.textContent + "</a></LI>"
        }
        t += "</ul>";
        document.getElementById("TableOfContents").innerHTML=t;
    </script>
    
</body>
</html>